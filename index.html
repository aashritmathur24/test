<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>Valentine Invitation</title>

    <!-- Confetti library -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>

    <style>
        :root {
            --bg1: #ffd6e7;
            --bg2: #ffeef6;
            --card: #ffffffcc;
            --yes: #ff3b7a;
            --yesHover: #ff1f68;
        }

        * { box-sizing: border-box; }

        body {
            margin: 0;
            min-height: 100vh;
            min-height: 100svh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: radial-gradient(circle at top, var(--bg2), var(--bg1));
            font-family: system-ui, sans-serif;
            overflow: hidden;
            padding: 20px;
        }

        /* FULL-SCREEN CONFETTI CANVAS */
        #confettiCanvas {
            position: fixed;
            inset: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none;
            z-index: 9999;
        }

        .card {
            width: 100%;
            max-width: 720px;
            padding: clamp(20px, 5vw, 26px);
            background: var(--card);
            backdrop-filter: blur(10px);
            border-radius: 22px;
            text-align: center;
            box-shadow: 0 18px 60px rgba(0,0,0,.15);
            margin: 0 auto;
        }

        .art {
            width: 100%;
            max-width: 260px;
            height: auto;
            margin: 0 auto 10px;
            display: block;
            filter: drop-shadow(0 10px 14px rgba(0,0,0,.12));
        }

        h1 {
            font-size: clamp(24px, 5vw, 44px);
            margin: 12px auto 18px;
            max-width: 100%;
        }

        .button-zone {
            position: relative;
            width: 100%;
            max-width: 520px;
            height: clamp(200px, 30vh, 250px);
            margin: 0 auto;
            touch-action: none;
        }

        button {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            padding: clamp(12px, 3vw, 16px) clamp(20px, 4vw, 24px);
            font-size: clamp(16px, 3.5vw, 18px);
            font-weight: 800;
            border-radius: 999px;
            border: none;
            cursor: pointer;
            box-shadow: 0 10px 24px rgba(0,0,0,.14);
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            transition: transform .12s ease, background .12s ease;
            white-space: nowrap;
        }

        #yesBtn {
            left: 18%;
            background: var(--yes);
            color: #fff;
        }
        #yesBtn:hover { background: var(--yesHover); }

        #noBtn {
            left: 62%;
            background: #e5e7eb;
            color: #111827;
            position: absolute;
        }

        #noBtn.free-move {
            position: fixed;
            z-index: 10000;
        }

        .hint {
            margin-top: 10px;
            font-size: 13px;
            opacity: .7;
            font-style: italic;
        }

        .result {
            display: none;
            margin-top: 18px;
            animation: pop .35s ease;
        }

        .result h1 {
            font-size: clamp(32px, 6vw, 48px);
            margin: 10px auto;
        }

        .result h2 {
            font-size: clamp(26px, 5vw, 38px);
            margin: 10px auto;
        }

        .result h3 {
            font-size: clamp(20px, 4vw, 28px);
            margin: 10px auto;
        }

        .fireworks {
            width: 100%;
            max-width: 380px;
            height: auto;
            margin: 20px auto;
            display: block;
        }

        @keyframes pop {
            from { transform: scale(.96); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
    </style>
</head>

<body>
<canvas id="confettiCanvas"></canvas>

<main class="card">
    <section class="initial-content" id="initialContent">
        <!-- ANIMAL WITH HEART -->
        <svg class="art" viewBox="0 0 320 240" xmlns="http://www.w3.org/2000/svg">
            <defs>
                <linearGradient id="fur" x1="0" x2="1">
                    <stop offset="0" stop-color="#f7c7a1"/>
                    <stop offset="1" stop-color="#f2a97b"/>
                </linearGradient>
                <linearGradient id="heart" x1="0" x2="1">
                    <stop offset="0" stop-color="#ff4d7d"/>
                    <stop offset="1" stop-color="#ff1f68"/>
                </linearGradient>
            </defs>

            <path d="M250 50 C250 33 270 25 282 38
                   C294 25 314 33 314 50
                   C314 78 282 92 282 106
                   C282 92 250 78 250 50Z"
                  fill="url(#heart)"/>

            <path d="M90 120 C90 70 140 40 190 60
                   C240 40 290 70 290 120
                   C290 180 240 210 190 210
                   C140 210 90 180 90 120Z"
                  fill="url(#fur)"/>

            <path d="M110 92 L95 55 L140 78 Z" fill="#f2a97b"/>
            <path d="M270 92 L285 55 L240 78 Z" fill="#f2a97b"/>

            <circle cx="160" cy="130" r="8"/>
            <circle cx="220" cy="130" r="8"/>

            <path d="M190 144 C186 144 182 148 182 152
                   C182 160 190 164 190 170
                   C190 164 198 160 198 152
                   C198 148 194 144 190 144Z"
                  fill="#ff7aa2"/>
        </svg>

        <h1>Truffles </h1> <br>
        <h1>Will you be my <br> Forever-tine?</h1>

        <section class="button-zone" id="zone">
            <button id="yesBtn">Yes üíï</button>
            <button id="noBtn">No</button>
        </section>

        <!-- HINT -->
<!--    <div class="hint" id="hint">"No" seems a bit shy üòà</div>-->
        <div class="hint" id="hint">"Every moment with you feels like a dream come true..."</div>
    </section>

    <section class="result" id="result">
        <h1>‚ù§Ô∏è YAY! üéâ ‚ù§Ô∏è</h1>
        <h2>I knew you'd say yes! üíï</h2>
        <img
                class="fireworks"
                src="Tanaash-proposal.jpg"
                alt="Fireworks"
        />
        <h3>You've made me the happiest! üíñ</h3>
    </section>
</main>

<script>
    const zone = document.getElementById("zone");
    const yesBtn = document.getElementById("yesBtn");
    const noBtn = document.getElementById("noBtn");
    const result = document.getElementById("result");
    const hint = document.getElementById("hint");

    /* ---------- CONFETTI ---------- */
    const confettiCanvas = document.getElementById("confettiCanvas");

    function resizeConfettiCanvas() {
        const dpr = Math.max(1, window.devicePixelRatio || 1);
        confettiCanvas.width = Math.floor(window.innerWidth * dpr);
        confettiCanvas.height = Math.floor(window.innerHeight * dpr);
        confettiCanvas.style.width = "100vw";
        confettiCanvas.style.height = "100vh";
    }

    resizeConfettiCanvas();
    window.addEventListener("resize", resizeConfettiCanvas);
    window.addEventListener("orientationchange", () => setTimeout(resizeConfettiCanvas, 150));

    const confettiInstance = confetti.create(confettiCanvas, {
        resize: false,
        useWorker: true
    });

    function fullScreenConfetti() {
        const end = Date.now() + 1600;

        (function frame() {
            confettiInstance({
                particleCount: 12,
                spread: 90,
                startVelocity: 45,
                ticks: 180,
                origin: { x: Math.random(), y: Math.random() * 0.3 }
            });
            if (Date.now() < end) requestAnimationFrame(frame);
        })();

        setTimeout(() => {
            confettiInstance({
                particleCount: 300,
                spread: 140,
                startVelocity: 60,
                ticks: 220,
                origin: { x: 0.5, y: 0.55 }
            });
        }, 300);
    }

    /* ---------- YES BUTTON GROWS ---------- */
    let yesScale = 1;
    function growYes() {
        yesScale = Math.min(2.2, yesScale + 0.1);
        yesBtn.style.transform = `translateY(-50%) scale(${yesScale})`;
    }

    /* ---------- NO BUTTON MOVES ON CLICK ---------- */
    const noTexts = [
        "No",
        "Really?",
        "Try again!",
        "You sure?",
        "Haha nice try!",
        "There is no escape üòà",
        "Nice try üòè",
        "You can't escape my love üíò",
        "Still no? Really? üòÇ",
        "You're trying to test my patience üòâ",
        "Nope! Not happening üôÖ"
    ];
    let noTextIndex = 0;

    function clamp(n, min, max) {
        return Math.max(min, Math.min(max, n));
    }

    function moveNo() {
        // CRITICAL: Change button text FIRST, then measure dimensions
        // This prevents the button from extending beyond viewport when text changes
        noTextIndex = (noTextIndex + 1) % noTexts.length;

        // Check if we've cycled through all texts
        if (noTextIndex === 0) {
            // We've completed the cycle, disable the button
            noBtn.disabled = true;
            noBtn.style.opacity = "0.5";
            noBtn.style.cursor = "not-allowed";
            noBtn.textContent = "Fine... Yes then! üòä";
            growYes();
            return;
        }

        noBtn.textContent = noTexts[noTextIndex];

        // Switch to fixed positioning to move anywhere on screen
        noBtn.classList.add('free-move');

        // Clear any transform to ensure clean positioning
        noBtn.style.transform = "none";

        // Measure button with the new text already applied
        const b = noBtn.getBoundingClientRect();
        const yesRect = yesBtn.getBoundingClientRect();

        // Get current position (center of button)
        const currentCenterX = b.left + b.width / 2;
        const currentCenterY = b.top + b.height / 2;

        // Generate random position anywhere on the screen with padding
        const padding = 40; // Increased padding to 40px for extra safety on mobile
        const viewportWidth = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);
        const viewportHeight = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);

        // Use Math.floor to prevent sub-pixel rendering issues
        const maxLeft = Math.floor(viewportWidth - b.width - padding);
        const maxTop = Math.floor(viewportHeight - b.height - padding);
        const minLeft = padding;
        const minTop = padding;

        console.log('Viewport:', viewportWidth, 'x', viewportHeight);
        console.log('Button size (AFTER text change):', b.width, 'x', b.height);
        console.log('Valid range - Left:', minLeft, 'to', maxLeft, 'Top:', minTop, 'to', maxTop);

        let newLeft, newTop, distance, attempts = 0;
        const minDistance = 150; // Minimum distance from current position
        const maxAttempts = 100; // Prevent infinite loops

        // Keep generating random positions until we find one far enough away
        do {
            newLeft = minLeft + Math.random() * Math.max(0, maxLeft - minLeft);
            newTop = minTop + Math.random() * Math.max(0, maxTop - minTop);

            // Ensure values are valid numbers
            if (isNaN(newLeft) || isNaN(newTop)) {
                newLeft = padding;
                newTop = padding;
                break;
            }

            // Calculate distance from center to center of current position
            const newCenterX = newLeft + b.width / 2;
            const newCenterY = newTop + b.height / 2;
            distance = Math.hypot(newCenterX - currentCenterX, newCenterY - currentCenterY);

            // Calculate distance from Yes button (avoid overlap)
            const yesCenterX = yesRect.left + yesRect.width / 2;
            const yesCenterY = yesRect.top + yesRect.height / 2;
            const distanceFromYes = Math.hypot(newCenterX - yesCenterX, newCenterY - yesCenterY);

            attempts++;

            // Accept position if it's far from current position and not too close to Yes button
            if (distance >= minDistance && distanceFromYes >= 100) {
                break;
            }

            // After many attempts, relax the constraints
            if (attempts > maxAttempts) {
                // Fallback: just avoid the Yes button
                if (distanceFromYes >= 100) {
                    break;
                }
            }
        } while (attempts <= maxAttempts);

        console.log('Final position - Left:', newLeft, 'Top:', newTop, 'Attempts:', attempts);

        // Apply position with strict clamping and floor to prevent sub-pixel issues
        const finalLeft = Math.floor(Math.max(padding, Math.min(maxLeft, newLeft)));
        const finalTop = Math.floor(Math.max(padding, Math.min(maxTop, newTop)));

        noBtn.style.left = finalLeft + "px";
        noBtn.style.top = finalTop + "px";
        noBtn.style.transform = "none";
        noBtn.style.visibility = "visible";
        noBtn.style.display = "block";

        // Grow the Yes button each time
        growYes();

        // Force reflow to ensure styles are applied
        void noBtn.offsetHeight;

        // Double-check position after setting to catch any browser rounding issues
        const finalBounds = noBtn.getBoundingClientRect();
        const actualRightEdge = finalBounds.left + finalBounds.width;
        const actualBottomEdge = finalBounds.top + finalBounds.height;

        console.log('Button positioned at:', finalLeft, 'x', finalTop);
        console.log('Actual rendered position:', finalBounds.left, 'x', finalBounds.top);
        console.log('Button right edge:', actualRightEdge, '(viewport width:', viewportWidth, ', safe limit:', viewportWidth - padding + ')');
        console.log('Button bottom edge:', actualBottomEdge, '(viewport height:', viewportHeight, ', safe limit:', viewportHeight - padding + ')');
        console.log('Text index:', noTextIndex);

        // If button somehow ended up out of bounds, reposition it
        if (actualRightEdge > viewportWidth - padding || actualBottomEdge > viewportHeight - padding) {
            console.warn('Button went out of bounds! Repositioning...');

            // Calculate safe position using actual rendered dimensions
            let safeLeft = finalLeft;
            let safeTop = finalTop;

            if (actualRightEdge > viewportWidth - padding) {
                safeLeft = Math.floor(viewportWidth - finalBounds.width - padding);
            }
            if (actualBottomEdge > viewportHeight - padding) {
                safeTop = Math.floor(viewportHeight - finalBounds.height - padding);
            }

            noBtn.style.left = safeLeft + "px";
            noBtn.style.top = safeTop + "px";

            console.log('Corrected to:', safeLeft, 'x', safeTop);
        }
    }

    noBtn.addEventListener("click", e => {
        e.preventDefault();

        // Don't move if button is disabled
        if (noBtn.disabled) {
            return;
        }

        moveNo();
    });

    /* ---------- YES CLICK ---------- */
    yesBtn.addEventListener("click", () => {
        // Hide the entire initial content section
        document.getElementById('initialContent').style.display = "none";

        result.style.display = "block";
        resizeConfettiCanvas();
        fullScreenConfetti();
    });
</script>
</body>
</html>
